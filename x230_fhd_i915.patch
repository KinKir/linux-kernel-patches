From 3c48cf108f27814bd2ac63b69f80d66bccd757e5 Mon Sep 17 00:00:00 2001
From: Mike Chau <mikechau@noreply.users.github.io>
Date: Sun, 25 Jun 2017 22:08:08 -0700
Subject: [PATCH] Add x230 FHD patch

---
 drivers/gpu/drm/i915/intel_dp.c   | 10 ++++++++--
 drivers/gpu/drm/i915/intel_lvds.c | 16 ++++++++++++++++
 2 files changed, 24 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_dp.c b/drivers/gpu/drm/i915/intel_dp.c
index d1670b8afbf5..4b7257f21d7f 100644
--- a/drivers/gpu/drm/i915/intel_dp.c
+++ b/drivers/gpu/drm/i915/intel_dp.c
@@ -108,7 +108,7 @@ static bool is_edp(struct intel_dp *intel_dp)
 {
 	struct intel_digital_port *intel_dig_port = dp_to_dig_port(intel_dp);
 
-	return intel_dig_port->base.type == INTEL_OUTPUT_EDP;
+	return intel_dig_port->base.type == INTEL_OUTPUT_EDP || strncmp(intel_dp->attached_connector->base.name, "DP-3", 4) == 0;
 }
 
 static struct drm_device *intel_dp_to_dev(struct intel_dp *intel_dp)
@@ -5017,7 +5017,13 @@ bool intel_dp_is_edp(struct drm_i915_private *dev_priv, enum port port)
 	if (INTEL_GEN(dev_priv) < 9 && port == PORT_A)
 		return true;
 
-	return intel_bios_is_port_edp(dev_priv, port);
+	if (intel_bios_is_port_edp(dev_priv, port))
+		return true;
+
+	if (port == PORT_D)
+		return true;
+
+	return false;
 }
 
 void
diff --git a/drivers/gpu/drm/i915/intel_lvds.c b/drivers/gpu/drm/i915/intel_lvds.c
index 9ca4dc4d2378..e70381ce5dbf 100644
--- a/drivers/gpu/drm/i915/intel_lvds.c
+++ b/drivers/gpu/drm/i915/intel_lvds.c
@@ -862,6 +862,22 @@ static const struct dmi_system_id intel_no_lvds[] = {
 			DMI_EXACT_MATCH(DMI_BOARD_NAME, "D525MW"),
 		},
 	},
+	{
+		.callback = intel_no_lvds_dmi_callback,
+		.ident = "Thinkpad X230 FHD",
+		.matches = {
+			DMI_MATCH(DMI_SYS_VENDOR, "LENOVO"),
+			DMI_MATCH(DMI_PRODUCT_NAME, "2324JC6")
+		}
+	},
+	{
+		.callback = intel_no_lvds_dmi_callback,
+		.ident = "Thinkpad X230 FHD",
+		.matches = {
+			DMI_MATCH(DMI_SYS_VENDOR, "LENOVO"),
+			DMI_MATCH(DMI_PRODUCT_NAME, "2324B14")
+		}
+	},
 
 	{ }	/* terminating entry */
 };
-- 
2.13.0

